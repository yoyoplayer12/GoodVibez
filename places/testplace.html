<script>
    // Connect to the WebSocket
    var ws = new WebSocket('wss://goodvibez.onrender.com/');

    ws.onmessage = function(event) {
        // Parse the message data
        var message = JSON.parse(event.data);

        // Find the HTML element that corresponds to the old message
        var oldMessageElement = document.getElementById('message-' + message._id);
        var date = new Date(message.timestamp);
        var formattedDate = date.getFullYear() + '-' + 
                            ('0' + (date.getMonth()+1)).slice(-2) + '-' + 
                            ('0' + date.getDate()).slice(-2) + ' at ' + 
                            ('0' + date.getHours()).slice(-2) + ':' + 
                            ('0' + date.getMinutes()).slice(-2);

        if (oldMessageElement) {
            // If the old message element exists, update its content
            oldMessageElement.querySelector('.message-user').innerHTML = message.username;
            oldMessageElement.querySelector('.message-text').innerHTML = message.text;
            oldMessageElement.querySelector('.message-time').innerHTML = formattedDate;
        } else {
            // If the old message element does not exist, this is a new message,
            // so create a new HTML element and append it to the message list
            var messageContainer = document.createElement('div');
            var messageUser = document.createElement('p');
            var messageText = document.createElement('p');
            var messageTime = document.createElement('p');
            // Set the innerHTML of the new element to the message data
            messageUser.innerHTML = message.username;
            messageText.innerHTML = message.text;
            messageTime.innerHTML = formattedDate;
            // Append the new elements to the container
            messageContainer.appendChild(messageUser);
            messageContainer.appendChild(messageText);
            messageContainer.appendChild(messageTime);
            // Assign the unique ID to the message container
            messageContainer.id = 'message-' + message._id;
            messageContainer.className = 'message';
            // Add classes to the message elements
            messageUser.className = 'message-user';
            messageText.className = 'message-text';
            messageTime.className = 'message-time';
            // Append the message container to the main container
            document.getElementById('message-container').appendChild(messageContainer);
        }
    };
document.addEventListener('DOMContentLoaded', (event) => {
    var submitInput = document.querySelector('.submit-input');

    // Add an event listener to the submit button
    submitInput.addEventListener('click', function(event) {
    // Prevent the default form submission
    event.preventDefault();
    var usernameInput = document.querySelector('.username-input');
    var messageInput = document.querySelector('.message-input');
    // Get the input values
    var username = usernameInput.value;
    var message = messageInput.value;

    // Make sure both inputs are not empty
    if (username && message) {
        // Send a POST request
        fetch('https://goodvibez.onrender.com/api/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                username: username,
                text: message,
            }),
        })
        .then(response => response.json())
        .then(data => {
            // Clear the input fields
            usernameInput.value = '';
            messageInput.value = '';
            // Handle the response data
            console.log('Message sent:', data);
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
});
});

</script>
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/main.css">
    <title>GoodVibez - The Test Place</title>
</head>
<body>
    <h1 style="text-align: center;">Test Place</h1>
    <div class="send-wrapper">
        <input type="text" placeholder="Username" class="username-input">
        <input type="text" placeholder="Message" class="message-input">
        <input type="submit" class="submit-input">
    </div>
    <h2>Messages:</h2>
    <div id="message-container"></div>
</body>
</html>